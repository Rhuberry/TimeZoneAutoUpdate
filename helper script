# Suppresses errors
$ErrorActionPreference = "SilentlyContinue"

# Points at the tzautoupdate service registry key
$tzReg = "HKLM:\SYSTEM\CurrentControlSet\Services\tzautoupdate"

# Ensure auto TZ is enabled
try { Set-ItemProperty -Path $tzReg -Name Start -Value 3 -Force } catch {}

# Start required services if not running
try {
    $lf = Get-Service lfsvc -ErrorAction SilentlyContinue
    if ($lf -and $lf.Status -ne "Running") { Start-Service lfsvc -ErrorAction SilentlyContinue }
} catch {}

try {
    $tz = Get-Service tzautoupdate -ErrorAction SilentlyContinue
    if ($tz -and $tz.Status -ne "Running") { Start-Service tzautoupdate -ErrorAction SilentlyContinue }
} catch {}

# Runs Windowsâ€™ built-in time zone sync executable
try { & "$env:windir\system32\tzsync.exe" | Out-Null } catch {}

exit 0
